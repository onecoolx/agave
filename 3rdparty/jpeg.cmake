# agave web browser
# 
# Copyright (C) 2024 Zhang Ji Peng
# Contact: onecoolx@gmail.com

include(ExternalProject)

set(JPEG_NAME "libjpeg-turbo")
set(JPEG_VERSION "3.0.3")
set(JPEG_PACKAGE "${PROJ_ROOT}/packages/${JPEG_NAME}-${JPEG_VERSION}.tar.gz")
set(JPEG_HASH "a649205a90e39a548863a3614a9576a3fb4465f8e8e66d54999f127957c25b21")

ExternalProject_Add(
  ${JPEG_NAME}
  PREFIX "${PROJ_OUT}/${JPEG_NAME}"
  URL "${JPEG_PACKAGE}"
  URL_HASH SHA256=${JPEG_HASH}
  BUILD_IN_SOURCE
  CMAKE_ARGS -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DWITH_JPEG8=TRUE -DENABLE_STATIC=TRUE -DENABLE_SHARED=FALSE -DCMAKE_INSTALL_PREFIX=${PROJ_OUT}
)

if(WIN32)
add_library(jpeg STATIC IMPORTED)
set_target_properties(jpeg PROPERTIES
  IMPORTED_LOCATION ${PROJ_OUT}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}jpeg-static${CMAKE_STATIC_LIBRARY_SUFFIX}
)

add_library(turbojpeg STATIC IMPORTED)
set_target_properties(turbojpeg PROPERTIES
  IMPORTED_LOCATION ${PROJ_OUT}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}turbojpeg-static${CMAKE_STATIC_LIBRARY_SUFFIX}
)
else()
add_library(jpeg STATIC IMPORTED)
set_target_properties(jpeg PROPERTIES
  IMPORTED_LOCATION ${PROJ_OUT}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}jpeg${CMAKE_STATIC_LIBRARY_SUFFIX}
)

add_library(turbojpeg STATIC IMPORTED)
set_target_properties(turbojpeg PROPERTIES
  IMPORTED_LOCATION ${PROJ_OUT}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}turbojpeg${CMAKE_STATIC_LIBRARY_SUFFIX}
)
endif()

set(LIB_DEPS ${LIB_DEPS} jpeg turbojpeg)
